pub use batch_header::BatchHeaderV1;
mod batch_header;

use crate::{
    check_buf_len,
    decoding::{
        batch::Batch, batch_header::BatchHeader, blob::BlobSliceIter, payload::PayloadData,
        transaction::Transaction, v0::BlockContextV0,
    },
    error::DecodingError,
    from_be_bytes_slice_and_advance_buf, L2Block,
};
use std::vec::Vec;

use alloy_primitives::bytes::Buf;
use bitvec::vec::BitVec;
use scroll_l1::abi::calls::CommitBatchCall;

/// The max amount of chunks per batch for V1 codec.
/// <https://github.com/scroll-tech/da-codec/blob/main/encoding/codecv0.go#L18>
const MAX_CHUNKS_PER_BATCH: usize = 15;

/// The index offset in the blob to the transaction data.
/// <https://github.com/scroll-tech/da-codec/blob/main/encoding/codecv1.go#L152>
const TRANSACTION_DATA_BLOB_INDEX_OFFSET: usize = 4 * MAX_CHUNKS_PER_BATCH;

/// The block context for v1 decoding is identical to the v0 decoding.
pub(crate) type BlockContextV1 = BlockContextV0;

/// Decodes the input calldata and blob into a [`Batch`].
pub fn decode_v1(calldata: &[u8], blob: &[u8]) -> Result<Batch, DecodingError> {
    // abi decode into a commit batch call
    let call = CommitBatchCall::try_decode(calldata).ok_or(DecodingError::InvalidCalldataFormat)?;

    // decode the parent batch header.
    let raw_parent_header = call.parent_batch_header().ok_or(DecodingError::MissingParentHeader)?;
    let parent_header = BatchHeader::try_from_buf(&mut (&*raw_parent_header))?;
    let l1_message_start_index = parent_header.total_l1_message_popped().expect("exists for v1");

    let chunks = call.chunks().ok_or(DecodingError::MissingChunkData)?;

    // get blob iterator and collect, skipping unused bytes.
    let heap_blob = BlobSliceIter::from_blob_slice(blob).copied().collect::<Vec<_>>();
    let buf = &mut (heap_blob.as_slice());

    // check buf len.
    check_buf_len!(buf, 2 + TRANSACTION_DATA_BLOB_INDEX_OFFSET);

    // check the chunk count is correct in debug.
    let chunk_count = from_be_bytes_slice_and_advance_buf!(u16, buf);
    debug_assert_eq!(chunks.len(), chunk_count as usize, "mismatched chunk count");

    // move pass chunk information.
    buf.advance(TRANSACTION_DATA_BLOB_INDEX_OFFSET);

    decode_v1_chunk(
        call.version(),
        call.skipped_l1_message_bitmap()?,
        l1_message_start_index,
        chunks,
        buf,
    )
}

/// Decode the provided chunks and blob data into [`L2Block`].
pub(crate) fn decode_v1_chunk(
    version: u8,
    skipped_l1_message_bitmap: Option<BitVec>,
    l1_message_start_index: u64,
    chunks: Vec<&[u8]>,
    blob: &[u8],
) -> Result<Batch, DecodingError> {
    let mut l2_blocks: Vec<L2Block> = Vec::new();
    let mut chunks_block_count = Vec::new();
    let blob = &mut &*blob;

    // iterate the chunks
    for chunk in chunks {
        let buf: &mut &[u8] = &mut &*chunk;

        // get the block count
        let blocks_count = buf.first().copied().ok_or(DecodingError::Eof)? as usize;
        chunks_block_count.push(blocks_count);
        buf.advance(1);

        let mut block_contexts: Vec<BlockContextV1> = Vec::with_capacity(blocks_count);
        l2_blocks.reserve(blocks_count);

        // for each block, decode into a block context
        for _ in 0..blocks_count {
            let context = BlockContextV1::try_from_buf(buf)?;
            block_contexts.push(context);
        }

        // for each block context, reserve the capacity for the transactions and decode
        // transactions.
        for context in block_contexts {
            let transactions_count = context.transactions_count();
            let mut transactions = Vec::with_capacity(transactions_count);
            for _ in 0..transactions_count {
                let tx = Transaction::try_from_buf(blob).ok_or(DecodingError::Eof)?;
                transactions.push(tx.0);
            }

            l2_blocks.push(L2Block::new(transactions, context.into()))
        }
    }

    let payload = PayloadData {
        blocks: l2_blocks,
        l1_message_queue_info: l1_message_start_index.into(),
        skipped_l1_message_bitmap,
    };

    Ok(Batch::new(version, Some(chunks_block_count), payload))
}

#[cfg(test)]
mod tests {
    use super::*;
    use crate::{decoding::test_utils::read_to_bytes, BlockContext};

    use alloy_primitives::{bytes, U256};

    #[test]
    fn test_should_decode_v1() -> eyre::Result<()> {
        // <https://etherscan.io/tx/0x27d73eef6f0de411f8db966f0def9f28c312a0ae5cfb1ac09ec23f8fa18b005b>
        let commit_calldata = read_to_bytes("./testdata/calldata_v1.bin")?;
        let blob = read_to_bytes("./testdata/blob_v1.bin")?;
        let blocks = decode_v1(&commit_calldata, &blob)?;

        assert_eq!(blocks.data.l2_blocks().len(), 12);

        let last_block = blocks.data.l2_blocks().last().expect("should have 12 blocks");
        let expected_block = L2Block {
            transactions: vec![
                bytes!(
                    "f9018d0b840c6aed6a8303c4739403290a52ba3164639067622e20b90857eaded29980b901245a47ddc300000000000000000000000006efdbff2a14a7c8e15944d1f4a48f9f95f663a400000000000000000000000095a52ec1d60e74cd3eb002fe54a2c74b185a4c16000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000004c4b400000000000000000000000000000000000000000000000485a88defc419ee30d0000000000000000000000000000000000000000000000000000000000487ab0000000000000000000000000000000000000000000000044bc686d6fa4bd57b3000000000000000000000000da84471519a3193f1a70b3dc44cbbad95cc1fb00000000000000000000000000000000000000000000000000000000006649bf9483104ec4a0eb1242ce33c73b3a551f21480efbaba9190f79241f880086959a3fca04474d4aa02265c4e0f869b4ac7cb3227b1133d4e133b335aa62b67e8ece0a7d188a89443b"
                ),
                bytes!(
                    "f8d182e39e841260cdb083085ba8946c1bf433a7c8549a61bc7818adfd8fe34083362e80b86700000000000013f5000059bf000004b4006905c59be1a7ea32d1f257e302401ec9a1401c5200000553000000000000000000000000000000000000041053a46826348d67cb8b29f7aeab784240e4d6ba00100206efdbff2a14a7c8e15944d1f4a48f9f95f663a483104ec3a04ecaa4624d8f365974a78b82f2ecd3e6f368b90308bfeec1f35ce07c0aba334ca02a3aebbba7d26cd6d39677baeeea876ef35367396163ad6123f22e191b991f0c"
                ),
                bytes!(
                    "f9016c108410249b09826e8e9447fbe95e981c0df9737b6971b451fb15fdc989d980b901045b7d7482000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000406366613731386630313632613931633437333861316537373466616535656537626130623639343466613936616566366336633230343831393266366339666400000000000000000000000000000000000000000000000000000000000000403861383566396136356162613936393539393935623166646461653837353963613462643235323333383039643539633562323132663039326164626531623483104ec3a0833996f40f3736941d946144c71949425c5b358e3fde33f86332f335b89d1a9da07e9d3e8f842da134c025f992acb57ea79a0a7a8d423eafd8675c666b9a9a5539"
                ),
                bytes!(
                    "f8ec03840f85a8c5830493e09411fcfe756c05ad438e312a7fd934381537d3cffe80b884617ba03700000000000000000000000006efdbff2a14a7c8e15944d1f4a48f9f95f663a400000000000000000000000000000000000000000000000000000000122dee4000000000000000000000000074e5ede2a0b08c1c102d11df230d8f1a35eb8f21000000000000000000000000000000000000000000000000000000000000000083104ec3a0aebc28ae05cb78aa9abf6107ccb72136075f88e357c2d7a482c81b156150fcdda0647ad2146c841bfa9bad81bd56d966422949583cedd6dd20b1586952ec829073"
                ),
                bytes!(
                    "f9020d02840f85a8c58302772f94aaaaaaaacb71bf2c8cae522ea5fa455571a7410680b901a4a15112f9000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006efdbff2a14a7c8e15944d1f4a48f9f95f663a400000000000000000000000000000000000000000000000000000000000001a400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000134fd90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100010000000000000000000000000000000000000000000000000016da83b8869789000000000000000000000000000000000000000000000000000000000000000083104ec4a04c054fdf0f54ad803831a856e1ce0f6c9a8816e36783f52729137a5c9ebf2adfa048ad4753e75993a0db427b0abef71b982f10a7c173aa6e37857abf148364189c"
                ),
                bytes!(
                    "f8d165840da8d1f5834c4b40940614eb91042383308db5ffd4e3c19376994045d980b86944c0ffee000000000000000000000000663bb50e021d675222304d1c09370a3922f46b63d6024ea768530000000000000000000000000000000000000401a16905c59be1a7ea32d1f257e302401ec9a1401c5206efdbff2a14a7c8e15944d1f4a48f9f95f663a401f083104ec3a04f9cb8b725c77886a85c8c3c4a02f010bfb9858e8c792a78e396368585172397a0188a82b3ac3edc191d1d832a5219f266aa9f6e2ec0947558b44d96dfd09d5d29"
                ),
                bytes!(
                    "f8ab46840da8d1f482eabf941d675222304d1c09370a3922f46b63d6024ea76880b844095ea7b3000000000000000000000000aa111c62cdeef205f70e6722d1e22274274ec12f00000000000000000000000000000000000000000000000000000002061d606083104ec3a021d5137f6238abffd72958720b37dfbc3deca20301aae611ef6049cb7443ee8fa00bc9c3b2dcd45fbda12938de0796a9a808fbe8abeaf3c11d18ace58483cd8a5a"
                ),
                bytes!(
                    "f902cd3b840da8d1f483036b399480e38291e06339d10aab483c65695d004dbd5c6980b902642cc4081e000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000100691070a7ac70000000000000000000000000000000000000000000000000000018f901d948b00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000006000000000000000000000000006efdbff2a14a7c8e15944d1f4a48f9f95f663a40000000000000000000000000000000000000000000000000000000000d8e42300000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000814a23b053fd0f102aeeda0459215c2444799c70000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000006000000000000000000000000006efdbff2a14a7c8e15944d1f4a48f9f95f663a400000000000000000000000092a6bb8be20cbb59cbc51801e2063aa1f2b9a37c0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000083104ec3a01b9ed91a324058a8c5ed65f2a68d710f4376bb60633b812f6f15507a2b0a9874a05aca21bbee0d77144bc669ece49deb8d99e73b999c36b0a8f90a4f5d50029f46"
                ),
                bytes!(
                    "f8ac28840da8d1f4830778b394ec53c830f4444a8a56455c6836b5d2aa794289aa80b844962941780000000000000000000000000d8f8e271dd3f2fc58e5716d3ff7041dbe3f0688000000000000000000000000000000000000000000000000000000000046227883104ec3a01fde8eea8fa4e323a12747e7b71e5f977e6ce5a767099af6171eba998f763fb9a07a34de8996eac217c372a19976e13dd353d1ccfb2fd809d65a9ff633b96371d6"
                ),
                bytes!(
                    "f9016d08840d29a9bd83031cb89418b71386418a9fca5ae7165e31c385a5130011b680b9010418cbafe500000000000000000000000000000000000000000000000000000000008f6ec0000000000000000000000000000000000000000000000000000a7910af6718d900000000000000000000000000000000000000000000000000000000000000a000000000000000000000000045d94cb8789a527369c59d7bca001647f4687af2000000000000000000000000000000000000000000000000000000006649c183000000000000000000000000000000000000000000000000000000000000000200000000000000000000000006efdbff2a14a7c8e15944d1f4a48f9f95f663a4000000000000000000000000530000000000000000000000000000000000000483104ec4a04f9482373c54d778c17c1c9d002952ee711fbffb193b76d4bd1e583e1ace59fea02a3859cc344fc5f6726cebc6f1ffb0aa1b1702d4bdf79b482352c55f9855bb73"
                ),
            ],
            context: BlockContext {
                number: 5802096,
                timestamp: 1716108620,
                base_fee: U256::ZERO,
                gas_limit: 10000000,
                num_transactions: 10,
                num_l1_messages: 0,
            },
        };

        assert_eq!(last_block, &expected_block);

        Ok(())
    }

    #[test]
    fn test_should_decode_v0_v1_boundary_batch() -> eyre::Result<()> {
        // <https://sepolia.etherscan.io/tx/0x34aa9c5caa32f128b99b473ebaab6b8164312a3548fef5ad9014abb5d3595505>
        let commit_calldata = bytes!("0x1325aca000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000054200000000000000000000000000000000000000000000000000000000000000079000000000000011033000000000000000b00000000000fdddb43af2218cdf1469728165c6bc6a75e9271d979b696f909ec8d627c87f3a3de5174e995ad0df099196b44a69097fd2df042b31b0f31236ae090a0a1be0362f62f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000ee000000000000000000000000000000000000000000000000000000000000015a00000000000000000000000000000000000000000000000000000000000001ca000000000000000000000000000000000000000000000000000000000000023e00000000000000000000000000000000000000000000000000000000000002aa000000000000000000000000000000000000000000000000000000000000031a000000000000000000000000000000000000000000000000000000000000038600000000000000000000000000000000000000000000000000000000000003ee000000000000000000000000000000000000000000000000000000000000045e00000000000000000000000000000000000000000000000000000000000004c600000000000000000000000000000000000000000000000000000000000000d5d390000000000392d3c00000000661cfd3a00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d3d00000000661cfd3d00000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d3e00000000661cfd4000000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d3f00000000661cfd4300000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4000000000661cfd4600000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4100000000661cfd4900000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4200000000661cfd4c00000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4300000000661cfd4f00000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4400000000661cfd5200000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4500000000661cfd5500000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4600000000661cfd5800000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4700000000661cfd5b00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d4800000000661cfd5f00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d4900000000661cfd6200000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4a00000000661cfd6500000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4b00000000661cfd6800000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4c00000000661cfd6b00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d4d00000000661cfd6e00000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d4e00000000661cfd7100000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d4f00000000661cfd7400000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d5000000000661cfd7700000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d5100000000661cfd7a00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d5200000000661cfd7d00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d5300000000661cfd8000000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d5400000000661cfd8300000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d5500000000661cfd8600000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d5600000000661cfd8900000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d5700000000661cfd8c00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d5800000000661cfd9000000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d5900000000661cfd9300000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d5a00000000661cfd9600000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d5b00000000661cfd9900000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d5c00000000661cfd9c00000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d5d00000000661cfd9f00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d5e00000000661cfda200000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d5f00000000661cfda500000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d6000000000661cfda800000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d6100000000661cfdab00000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d6200000000661cfdae00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d6300000000661cfdb100000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d6400000000661cfdb400000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d6500000000661cfdb700000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d6600000000661cfdba00000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d6700000000661cfdbd00000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d6800000000661cfdc000000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d6900000000661cfdc300000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d6a00000000661cfdc600000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d6b00000000661cfdc900000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d6c00000000661cfdcc00000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392d6d00000000661cfdcf00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d6e00000000661cfdd200000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d6f00000000661cfdd500000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d7000000000661cfdd800000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d7100000000661cfddb00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d7200000000661cfdde00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d7300000000661cfde100000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d7400000000661cfde4000000000000000000000000000000000000000000000000000000000000000000000000009896800004000000000000000000000000000000000000000000000000000000000000000000000006911c0000000000392d7500000000661cfde700000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d7600000000661cfdea00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d7700000000661cfded00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d7800000000661cfdf000000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d7900000000661cfdf300000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392d7a00000000661cfdf600000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d7b00000000661cfdf900000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d7c00000000661cfdfc00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d7d00000000661cfdff00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d7e00000000661cfe0200000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d7f00000000661cfe0500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d8000000000661cfe0800000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392d8100000000661cfe0b00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d8200000000661cfe0e00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d8300000000661cfe1100000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d8400000000661cfe1400000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d8500000000661cfe1700000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d8600000000661cfe1a00000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392d8700000000661cfe1d00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d8800000000661cfe2000000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d8900000000661cfe2300000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d8a00000000661cfe2600000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d8b00000000661cfe2900000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d8c00000000661cfe2c00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d8d00000000661cfe2f00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d8e00000000661cfe3200000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d8f00000000661cfe3500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d9000000000661cfe38000000000000000000000000000000000000000000000000000000000000000000000000009896800002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006cd1d0000000000392d9100000000661cfe3b00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d9200000000661cfe3e00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d9300000000661cfe4100000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d9400000000661cfe4400000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d9500000000661cfe4700000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d9600000000661cfe4a00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d9700000000661cfe4d00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d9800000000661cfe5000000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d9900000000661cfe5300000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d9a00000000661cfe5600000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d9b00000000661cfe5900000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d9c00000000661cfe5c00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392d9d00000000661cfe5f00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392d9e00000000661cfe6200000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392d9f00000000661cfe6500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392da000000000661cfe6800000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392da100000000661cfe6b00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392da200000000661cfe6e00000000000000000000000000000000000000000000000000000000000000000000000000989680000500020000000000392da300000000661cfe7100000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392da400000000661cfe7400000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392da500000000661cfe7700000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392da600000000661cfe7a00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392da700000000661cfe7d00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392da800000000661cfe8000000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392da900000000661cfe8300000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392daa00000000661cfe8600000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392dab00000000661cfe8900000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dac00000000661cfe8c00000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392dad00000000661cfe8f00000000000000000000000000000000000000000000000000000000000000000000000000989680000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007091e0000000000392dae00000000661cfe9200000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392daf00000000661cfe9500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392db000000000661cfe9800000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392db100000000661cfe9b00000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392db200000000661cfe9e00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392db300000000661cfea100000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392db400000000661cfea400000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392db500000000661cfea700000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392db600000000661cfeaa00000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392db700000000661cfead00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392db800000000661cfeb000000000000000000000000000000000000000000000000000000000000000000000000000989680000100000000000000392db900000000661cfeb300000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dba00000000661cfeb600000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dbb00000000661cfeb900000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dbc00000000661cfebc00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dbd00000000661cfebf00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dbe00000000661cfec200000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dbf00000000661cfec500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dc000000000661cfec800000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dc100000000661cfecb00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dc200000000661cfece00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dc300000000661cfed100000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dc400000000661cfed400000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392dc500000000661cfed700000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dc600000000661cfeda00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dc700000000661cfedd00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dc800000000661cfee000000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dc900000000661cfee300000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dca00000000661cfee600000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dcb00000000661cfee90000000000000000000000000000000000000000000000000000000000000000000000000098968000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006911c0000000000392dcc00000000661cfeec00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dcd00000000661cfeef00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dce00000000661cfef200000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dcf00000000661cfef500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dd000000000661cfef800000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dd100000000661cfefb00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dd200000000661cfefe00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dd300000000661cff0100000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dd400000000661cff0400000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dd500000000661cff0700000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dd600000000661cff0a00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dd700000000661cff0d00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dd800000000661cff1000000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392dd900000000661cff1300000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dda00000000661cff1600000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392ddb00000000661cff1900000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392ddc00000000661cff1c00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392ddd00000000661cff1f00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dde00000000661cff2200000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392ddf00000000661cff2500000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392de000000000661cff2800000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392de100000000661cff2b00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392de200000000661cff2e00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392de300000000661cff3100000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392de400000000661cff3400000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392de500000000661cff3700000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392de600000000661cff3a00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392de700000000661cff3d000000000000000000000000000000000000000000000000000000000000000000000000009896800004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006cd1d0000000000392de800000000661cff4000000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392de900000000661cff4300000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dea00000000661cff4600000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392deb00000000661cff4900000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dec00000000661cff4c00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392ded00000000661cff4f00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dee00000000661cff5200000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392def00000000661cff5500000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392df000000000661cff5800000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392df100000000661cff5b00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392df200000000661cff5e00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392df300000000661cff6100000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392df400000000661cff6400000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392df500000000661cff6700000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392df600000000661cff6a00000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392df700000000661cff6d00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392df800000000661cff7000000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392df900000000661cff7300000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dfa00000000661cff7600000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392dfb00000000661cff7900000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dfc00000000661cff7c00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392dfd00000000661cff7f00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392dfe00000000661cff8200000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392dff00000000661cff8500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e0000000000661cff8800000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e0100000000661cff8b00000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392e0200000000661cff8e00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e0300000000661cff9100000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392e0400000000661cff9400000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006911c0000000000392e0500000000661cff9700000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e0600000000661cff9a00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e0700000000661cff9d00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e0800000000661cffa000000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e0900000000661cffa300000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e0a00000000661cffa600000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e0b00000000661cffa900000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e0c00000000661cffac00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e0d00000000661cffaf00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e0e00000000661cffb200000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e0f00000000661cffb500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e1000000000661cffb800000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e1100000000661cffbb00000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392e1200000000661cffbe00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e1300000000661cffc100000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e1400000000661cffc400000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e1500000000661cffc700000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392e1600000000661cffca00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e1700000000661cffcd00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e1800000000661cffd000000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e1900000000661cffd300000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e1a00000000661cffd600000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e1b00000000661cffd900000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e1c00000000661cffdc00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e1d00000000661cffdf00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e1e00000000661cffe200000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e1f00000000661cffe500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e2000000000661cffe8000000000000000000000000000000000000000000000000000000000000000000000000009896800004000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006551b0000000000392e2100000000661cffeb00000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392e2200000000661cffee00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e2300000000661cfff100000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e2400000000661cfff400000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e2500000000661cfff700000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e2600000000661cfffa00000000000000000000000000000000000000000000000000000000000000000000000000989680000700000000000000392e2700000000661cfffd00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e2800000000661d000000000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e2900000000661d000300000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e2a00000000661d000600000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e2b00000000661d000900000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e2c00000000661d000c00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e2d00000000661d000f00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e2e00000000661d001200000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e2f00000000661d001500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3000000000661d001800000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3100000000661d001b00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e3200000000661d001e00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3300000000661d002100000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3400000000661d002400000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3500000000661d002700000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3600000000661d002a00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3700000000661d002d00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e3800000000661d003000000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e3900000000661d003300000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3a00000000661d003600000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3b00000000661d00390000000000000000000000000000000000000000000000000000000000000000000000000098968000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000006cd1d0000000000392e3c00000000661d003c00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3d00000000661d003f00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3e00000000661d004200000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e3f00000000661d004500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e4000000000661d004800000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e4100000000661d004b00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e4200000000661d004e00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e4300000000661d005100000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e4400000000661d005400000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e4500000000661d005700000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e4600000000661d005a00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e4700000000661d005d00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e4800000000661d006000000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e4900000000661d006300000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e4a00000000661d006600000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e4b00000000661d006900000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e4c00000000661d006c00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e4d00000000661d006f00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e4e00000000661d007200000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e4f00000000661d007500000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e5000000000661d007800000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e5100000000661d007b00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e5200000000661d007e00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e5300000000661d008100000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e5400000000661d008400000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e5500000000661d008700000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e5600000000661d008a00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e5700000000661d008d00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e5800000000661d009000000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006551b0000000000392e5900000000661d009300000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e5a00000000661d009600000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e5b00000000661d009900000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e5c00000000661d009c00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e5d00000000661d009f00000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392e5e00000000661d00a200000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e5f00000000661d00a500000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e6000000000661d00a800000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e6100000000661d00ab00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e6200000000661d00ae00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e6300000000661d00b100000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e6400000000661d00b400000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e6500000000661d00b700000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e6600000000661d00ba00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e6700000000661d00bd00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e6800000000661d00c000000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e6900000000661d00c300000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e6a00000000661d00c600000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392e6b00000000661d00c900000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e6c00000000661d00cc00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e6d00000000661d00cf00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e6e00000000661d00d200000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e6f00000000661d00d500000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e7000000000661d00d800000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e7100000000661d00db00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e7200000000661d00de00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e7300000000661d00e10000000000000000000000000000000000000000000000000000000000000000000000000098968000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000006551b0000000000392e7400000000661d00e400000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e7500000000661d00e700000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e7600000000661d00ea00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e7700000000661d00ed00000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e7800000000661d00f000000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e7900000000661d00f300000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e7a00000000661d00f600000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e7b00000000661d00f900000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392e7c00000000661d00fc00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e7d00000000661d00ff00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e7e00000000661d010200000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e7f00000000661d010500000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e8000000000661d010800000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e8100000000661d010b00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e8200000000661d010e00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e8300000000661d011100000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e8400000000661d011400000000000000000000000000000000000000000000000000000000000000000000000000989680000300000000000000392e8500000000661d011700000000000000000000000000000000000000000000000000000000000000000000000000989680000600000000000000392e8600000000661d011a00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e8700000000661d011d00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e8800000000661d012000000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e8900000000661d012300000000000000000000000000000000000000000000000000000000000000000000000000989680000500000000000000392e8a00000000661d012600000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e8b00000000661d012900000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e8c00000000661d012c00000000000000000000000000000000000000000000000000000000000000000000000000989680000200000000000000392e8d00000000661d012f00000000000000000000000000000000000000000000000000000000000000000000000000989680000400000000000000392e8e00000000661d01320000000000000000000000000000000000000000000000000000000000000000000000000098968000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000");
        let blob = read_to_bytes("./testdata/blob_v0_v1_boundary.bin")?;
        let blocks = decode_v1(&commit_calldata, &blob)?;

        assert_eq!(blocks.data.l2_blocks().len(), 339);

        let last_block = blocks.data.l2_blocks().last().expect("should have 339 blocks");
        let expected_block = L2Block {
            transactions: vec![
                bytes!("f8698217648405f5e100830186a09418960eec21b1878c581937a14c5c3c43008f6b6b808083104ec2a0d9e6ba0d8798ad4428c0a1328454f9067a7eae74907b5f4df6ada9829ef3d30ba01506ffb6ad8758e5b02ed857e710b5000b38308e27a7d0300220ad6f19c56b0b"),
                bytes!("f8698217658405f5e100830186a09418960eec21b1878c581937a14c5c3c43008f6b6b808083104ec1a0a57b86083b73e878839e2ede0c21a8a54d0ceb0fbf0556d771b70bd8032c3ddfa04af908c281bd48060039264a662d64bf83813cd205f83363817b19441d973e7f"),
                bytes!("f8698217668405f5e100830186a09418960eec21b1878c581937a14c5c3c43008f6b6b808083104ec2a0ba13b841673802a0accd1ab06821c404281d83506f4922b4d79d3a9a176c9615a007339b1ff101552761434da99bd1b06a3e894358fb93fac9ac04b02197d71f09"),
            ],
            context: BlockContext {
                number: 3747470,
                timestamp: 1713176882,
                base_fee: U256::ZERO,
                gas_limit: 10000000,
                num_transactions: 3,
                num_l1_messages: 0,
            },
        };

        assert_eq!(last_block, &expected_block);

        Ok(())
    }
}
